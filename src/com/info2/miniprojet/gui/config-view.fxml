<?xml version="1.0" encoding="UTF-8"?>

<?import javafx.geometry.Insets?>
<?import javafx.scene.control.Button?>
<?import javafx.scene.control.ComboBox?>
<?import javafx.scene.control.Label?>
<?import javafx.scene.control.RadioButton?>
<?import javafx.scene.control.Spinner?>
<?import javafx.scene.control.SpinnerValueFactory.DoubleSpinnerValueFactory?>
<?import javafx.scene.control.SpinnerValueFactory.IntegerSpinnerValueFactory?>
<?import javafx.scene.control.ToggleGroup?>
<?import javafx.scene.layout.GridPane?>
<?import javafx.scene.layout.HBox?>
<?import javafx.scene.layout.VBox?>
<?import javafx.scene.text.Font?>
<?import javafx.scene.layout.ColumnConstraints?>
<?import javafx.scene.layout.Priority?>

<?import javafx.scene.control.ListView?>
<VBox prefWidth="600.0" prefHeight="550.0" spacing="15.0" xmlns="http://javafx.com/javafx/17" xmlns:fx="http://javafx.com/fxml/1" fx:controller="com.info2.miniprojet.gui.ConfigViewController">
    <padding>
        <Insets bottom="15.0" left="15.0" right="15.0" top="15.0" />
    </padding>
    <children>
        <Label text="Application Configuration">
            <font>
                <Font name="System Bold" size="16.0" />
            </font>
        </Label>

        <GridPane hgap="10" vgap="10">
            <columnConstraints>
                <ColumnConstraints hgrow="NEVER" minWidth="200.0" prefWidth="200.0"/>
                <ColumnConstraints hgrow="ALWAYS" />
            </columnConstraints>

            <Label text="Preprocessor Strategy:" GridPane.rowIndex="0" GridPane.columnIndex="0" GridPane.columnSpan="2" style="-fx-font-weight: bold;"/>

            <Label text="Mode:" GridPane.rowIndex="1" GridPane.columnIndex="0"/>
            <ComboBox fx:id="preprocessorModeComboBox" onAction="#onPreprocessorModeSelected" maxWidth="Infinity" GridPane.rowIndex="1" GridPane.columnIndex="1"/>

            <!-- This HBox will contain pipeline building UI, only visible if "PIPELINE" mode is selected -->
            <HBox fx:id="pipelineBuilderBox" spacing="10" visible="false" managed="false" GridPane.rowIndex="2" GridPane.columnIndex="0" GridPane.columnSpan="2" alignment="CENTER_LEFT">
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Available Stages:"/>
                    <ListView fx:id="availableStagesListView" prefHeight="100.0"/>
                </VBox>
                <VBox spacing="5" alignment="CENTER">
                    <Button fx:id="addStageButton" text="&gt;&gt;" onAction="#addStageToPipelineAction"/>
                    <Button fx:id="removeStageButton" text="&lt;&lt;" onAction="#removeStageFromPipelineAction"/>
                    <Button fx:id="moveStageUpButton" text="Up" onAction="#moveStageUpAction"/>
                    <Button fx:id="moveStageDownButton" text="Down" onAction="#moveStageDownAction"/>
                </VBox>
                <VBox spacing="5" HBox.hgrow="ALWAYS">
                    <Label text="Selected Pipeline Stages (in order):"/>
                    <ListView fx:id="selectedStagesListView" prefHeight="100.0"/>
                </VBox>
            </HBox>

            <!-- The rest of the GridPane (CandidateFinder, NameComparator, etc.) needs its GridPane.rowIndex adjusted -->
            <!-- Example: CandidateFinder was rowIndex="1", now needs to be rowIndex="3" (or more if pipeline UI takes more rows) -->

            <Label text="Candidate Finder Strategy:" GridPane.rowIndex="3" GridPane.columnIndex="0" />
            <ComboBox fx:id="candidateFinderComboBox" maxWidth="Infinity" GridPane.rowIndex="3" GridPane.columnIndex="1" />

            <Label text="Name Comparator Strategy:" GridPane.rowIndex="4" GridPane.columnIndex="0" />
            <ComboBox fx:id="nameComparatorComboBox" onAction="#onNameComparatorSelected" maxWidth="Infinity" GridPane.rowIndex="4" GridPane.columnIndex="1" />

            <Label fx:id="stringComparatorLabel" text="Internal String Comparator:" GridPane.rowIndex="5" GridPane.columnIndex="0" />
            <ComboBox fx:id="stringComparatorComboBox" maxWidth="Infinity" GridPane.rowIndex="5" GridPane.columnIndex="1" />

            <Label text="Result Filtering Mode:" GridPane.rowIndex="6" GridPane.columnIndex="0" />
            <HBox spacing="10" GridPane.rowIndex="6" GridPane.columnIndex="1">
                <!-- ToggleGroup and RadioButtons as before -->
                <fx:define> <ToggleGroup fx:id="resultModeToggleGroup" /> </fx:define>
                <RadioButton fx:id="thresholdModeRadio" text="Threshold" toggleGroup="$resultModeToggleGroup" onAction="#onResultModeChanged"/>
                <RadioButton fx:id="maxResultsModeRadio" text="Max Results" toggleGroup="$resultModeToggleGroup" onAction="#onResultModeChanged"/>
            </HBox>

            <Label fx:id="thresholdLabel" text="Similarity/Distance Threshold:" GridPane.rowIndex="7" GridPane.columnIndex="0" />
            <Spinner fx:id="thresholdSpinner" editable="true" maxWidth="Infinity" GridPane.rowIndex="7" GridPane.columnIndex="1">
                <!-- ValueFactory as before -->
            </Spinner>

            <Label fx:id="maxResultsLabel" text="Max Number of Results:" GridPane.rowIndex="8" GridPane.columnIndex="0" />
            <Spinner fx:id="maxResultsSpinner" editable="true" maxWidth="Infinity" GridPane.rowIndex="8" GridPane.columnIndex="1">
                <!-- ValueFactory as before -->
            </Spinner>

        </GridPane>

        <HBox alignment="CENTER_RIGHT" spacing="10.0">
            <children>
                <Button fx:id="saveButton" onAction="#saveConfigurationAction" text="Save and Close" prefWidth="120"/>
                <Button fx:id="cancelButton" onAction="#cancelAction" text="Cancel" prefWidth="80"/>
            </children>
            <VBox.margin>
                <Insets top="20.0" />
            </VBox.margin>
        </HBox>
    </children>
</VBox>